<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Staff Portal | OneZeroLabs</title>

  <link rel="icon" type="image/png" href="images/logo2.png" />
  <script src="js/config.js"></script>
  <!-- Fonts -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#1a1a1a">

  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

  <style>
    :root {
      --primary: #4F46E5;
      --primary-glow: rgba(79, 70, 229, 0.4);
      --glass-surface: rgba(255, 255, 255, 0.65);
      --text-dark: #0f172a;
      --text-gray: #64748b;
      --error-bg: rgba(239, 68, 68, 0.1);
      --error-text: #EF4444;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Plus Jakarta Sans', sans-serif;
      /* Your Requested Background */
      background: linear-gradient(135deg, #eef2f3 0%, #e0eafc 100%);
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      position: relative;
    }

    /* --- TECH GRID OVERLAY --- */
    .grid-overlay {
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(rgba(99, 102, 241, 0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(99, 102, 241, 0.05) 1px, transparent 1px);
      background-size: 40px 40px;
      z-index: 0;
      pointer-events: none;
    }

    /* --- ABSTRACT FLOATING SHAPES --- */
    .shape {
      position: absolute;
      filter: blur(50px);
      z-index: 0;
      animation: floatShape 12s infinite alternate;
    }

    .shape-1 {
      top: 10%;
      left: 20%;
      width: 300px;
      height: 300px;
      background: rgba(199, 210, 254, 0.6);
      border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%;
    }

    .shape-2 {
      bottom: 15%;
      right: 20%;
      width: 250px;
      height: 250px;
      background: rgba(224, 231, 255, 0.8);
      border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
      animation-delay: -2s;
    }

    @keyframes floatShape {
      0% {
        transform: translate(0, 0) rotate(0deg);
      }

      100% {
        transform: translate(20px, 40px) rotate(10deg);
      }
    }

    /* --- LOGIN CARD --- */
    .login-card {
      position: relative;
      z-index: 10;
      width: 420px;
      background: var(--glass-surface);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid white;
      border-radius: 24px;
      padding: 48px 36px;
      box-shadow:
        0 20px 50px -10px rgba(0, 0, 0, 0.08),
        0 0 0 1px rgba(255, 255, 255, 0.5) inset;
      text-align: center;
    }

    /* Logo Area */
    .logo-wrapper {
      width: 72px;
      height: 72px;
      margin: 0 auto 24px;
      position: relative;
    }

    .logo-bg {
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, #6366F1, #8B5CF6);
      border-radius: 18px;
      transform: rotate(-6deg);
      opacity: 0.2;
      transition: transform 0.4s ease;
    }

    .logo-img-box {
      position: relative;
      width: 100%;
      height: 100%;
      background: white;
      border-radius: 18px;
      padding: 12px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
      z-index: 2;
      transition: transform 0.4s ease;
    }

    .login-card:hover .logo-bg {
      transform: rotate(-12deg) scale(1.1);
    }

    .login-card:hover .logo-img-box {
      transform: translateY(-4px);
    }

    .logo-img-box img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* Typography */
    h1 {
      font-size: 22px;
      font-weight: 800;
      color: var(--text-dark);
      margin-bottom: 6px;
      letter-spacing: -0.5px;
    }

    .subtitle {
      font-size: 13px;
      color: var(--text-gray);
      font-weight: 500;
      margin-bottom: 24px;
    }

    /* Error Message Box */
    .error-msg {
      background: var(--error-bg);
      color: var(--error-text);
      font-size: 12px;
      font-weight: 600;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
      /* Hidden by default */
      text-align: left;
      border: 1px solid rgba(239, 68, 68, 0.2);
    }

    /* Inputs */
    .input-container {
      margin-bottom: 18px;
      text-align: left;
    }

    .input-label {
      font-size: 11px;
      font-weight: 700;
      color: var(--text-dark);
      margin-bottom: 8px;
      display: block;
      margin-left: 4px;
    }

    .input-group {
      position: relative;
    }

    .custom-input {
      width: 100%;
      padding: 14px 16px 14px 44px;
      border: 2px solid transparent;
      background: white;
      border-radius: 14px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-dark);
      font-family: inherit;
      outline: none;
      transition: all 0.2s;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.03);
    }

    .custom-input:focus {
      border-color: var(--primary);
      box-shadow: 0 4px 15px var(--primary-glow);
    }

    .input-icon {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: #94A3B8;
      font-size: 20px;
      transition: 0.2s;
    }

    .custom-input:focus~.input-icon {
      color: var(--primary);
    }

    .toggle-pw {
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      color: #94A3B8;
      display: flex;
      align-items: center;
    }

    .toggle-pw:hover {
      color: var(--text-dark);
    }

    /* Button */
    .submit-btn {
      width: 100%;
      margin-top: 12px;
      padding: 16px;
      border: none;
      border-radius: 14px;
      background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%);
      color: white;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: all 0.3s;
      box-shadow: 0 8px 20px rgba(79, 70, 229, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 25px rgba(79, 70, 229, 0.4);
    }

    .submit-btn:disabled {
      background: #94A3B8;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .btn-shine {
      position: absolute;
      top: 0;
      left: -100%;
      width: 50%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transform: skewX(-20deg);
      transition: 0.5s;
    }

    .submit-btn:hover .btn-shine {
      left: 150%;
      transition: 0.5s;
    }

    /* Footer */
    .footer {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid rgba(0, 0, 0, 0.06);
      font-size: 11px;
      color: var(--text-gray);
    }

    .brand-tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(255, 255, 255, 0.6);
      padding: 6px 12px;
      border-radius: 20px;
      margin-top: 8px;
      border: 1px solid white;
    }

    .brand-tag strong {
      color: var(--text-dark);
      font-weight: 700;
    }

    /* reCAPTCHA badge - hide but keep functional */
    .grecaptcha-badge {
      visibility: hidden !important;
    }

    .recaptcha-notice {
      font-size: 10px;
      color: var(--text-gray);
      margin-top: 12px;
      line-height: 1.4;
    }

    .recaptcha-notice a {
      color: var(--primary);
      text-decoration: none;
    }
  </style>

  <!-- Google reCAPTCHA v3 -->
  <script src="https://www.google.com/recaptcha/api.js?render=6LdcSVQsAAAAACPk9EagT6YZdwOI6sRRfrVeFNd5"></script>
</head>

<body>

  <div class="grid-overlay"></div>
  <div class="shape shape-1"></div>
  <div class="shape shape-2"></div>

  <div class="login-card">
    <div class="logo-wrapper">
      <div class="logo-bg"></div>
      <div class="logo-img-box">
        <img src="logo2.png" alt="Portal Logo">
      </div>
    </div>

    <h1>Admin Access</h1>
    <p class="subtitle">Academic Registry Login</p>

    <!-- ERROR MESSAGE BOX -->
    <div id="errorBox" class="error-msg"></div>

    <form id="authForm">
      <div class="input-container">
        <label class="input-label">USER ID</label>
        <div class="input-group">
          <input type="email" id="email" class="custom-input" placeholder="Email" required>
          <span class="material-symbols-rounded input-icon">badge</span>
        </div>
      </div>

      <div class="input-container">
        <label class="input-label">PASSWORD</label>
        <div class="input-group">
          <input type="password" id="password" class="custom-input" placeholder="••••••••" required>
          <span class="material-symbols-rounded input-icon">lock</span>
          <button type="button" class="toggle-pw" onclick="togglePw()">
            <span class="material-symbols-rounded" id="eyeIcon">visibility</span>
          </button>
        </div>
      </div>

      <button type="submit" class="submit-btn" id="submitBtn">
        <div class="btn-shine"></div>
        <span id="btnText">AUTHENTICATE</span>
        <span class="material-symbols-rounded" style="font-size:18px">login</span>
      </button>

      <!-- reCAPTCHA Notice (required by Google) -->
      <p class="recaptcha-notice">
        Protected by reCAPTCHA.
        <a href="https://policies.google.com/privacy" target="_blank">Privacy</a> ·
        <a href="https://policies.google.com/terms" target="_blank">Terms</a>
      </p>
    </form>

    <div class="footer">
      <div class="brand-tag">
        Powered by <strong>OneZeroLabs</strong>
      </div>
    </div>
  </div>

  <!-- Firebase Logic with reCAPTCHA -->
  <script type="module">
    import { firebaseConfig } from './firebase-config.js';
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // reCAPTCHA Site Key
    const RECAPTCHA_SITE_KEY = '6LdcSVQsAAAAACPk9EagT6YZdwOI6sRRfrVeFNd5';

    // Get Elements
    const loginForm = document.getElementById('authForm');
    const submitBtn = document.getElementById('submitBtn');
    const btnText = document.getElementById('btnText');
    const errorBox = document.getElementById('errorBox');

    // Handle Login with reCAPTCHA
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      // 1. Reset Error
      errorBox.style.display = 'none';
      errorBox.textContent = '';

      // 2. Set Loading State
      submitBtn.disabled = true;
      btnText.textContent = "VERIFYING...";

      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      try {
        // 3. Get reCAPTCHA Token
        btnText.textContent = "SECURITY CHECK...";

        const recaptchaToken = await grecaptcha.execute(RECAPTCHA_SITE_KEY, { action: 'login' });
        console.log('reCAPTCHA token obtained');

        // 4. Verify reCAPTCHA with backend (optional but recommended)
        // For now, we'll use client-side only. 
        // In production, send token to backend for verification

        // 5. Attempt Firebase Login
        btnText.textContent = "AUTHENTICATING...";
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        console.log("Success:", userCredential.user.uid);

        // 6. Store reCAPTCHA verification for session
        sessionStorage.setItem('recaptchaVerified', 'true');

        // 7. Redirect to Dashboard
        window.location.href = "dashboard.html";

      } catch (error) {
        console.error("Error:", error.code || error.message);

        // Show Error Message
        errorBox.style.display = 'block';

        if (error.message && error.message.includes('reCAPTCHA')) {
          errorBox.textContent = "Security verification failed. Please try again.";
        } else if (error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
          errorBox.textContent = "Incorrect password.";
        } else if (error.code === 'auth/user-not-found') {
          errorBox.textContent = "User not found.";
        } else if (error.code === 'auth/invalid-email') {
          errorBox.textContent = "Invalid email format.";
        } else if (error.code === 'auth/too-many-requests') {
          errorBox.textContent = "Too many attempts. Try again later.";
        } else {
          errorBox.textContent = "Login failed. Please try again.";
        }

        // Reset Button
        submitBtn.disabled = false;
        btnText.textContent = "AUTHENTICATE";
      }
    });
  </script>

  <script>
    localStorage.setItem('userType', 'nonteaching');

    function togglePw() {
      const p = document.getElementById('password');
      const i = document.getElementById('eyeIcon');
      if (p.type === 'password') { p.type = 'text'; i.textContent = 'visibility_off'; }
      else { p.type = 'password'; i.textContent = 'visibility'; }
    }
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/service-worker.js");
    }

  </script>

</body>

</html>